<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta name="generator" content="jemdoc, see http://jemdoc.jaboc.net/" />
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" href="metro_style/metro-bootstrap.css" media="screen">
<link rel="stylesheet" href="private.css" media="screen">
<script src="metro_style/jquery.min.js"></script>
<script src="metro_style/jquery.widget.min.js"></script>
<script src="metro_style/metro.min.js"></script>
<title></title>
</head>
<body class="metro">
<header class="bg-light">
<div class="navigation-bar light">
<div class="navigation-bar-content container">
<nav class="horizontal-menu"><ul class="element-menu">
<li><a href="index.html">Main</a></li>
<li><a href="publications.html">Publications</a></li>
<li><a class="dropdown-toggle" href="#">Research</a>
<ul class="dropdown-menu" data-role="dropdown">
<li><a href="bsbl.html">BSBL</a></li>
<li><a href="eit.html">EIT</a></li>
<li><a href="connectomics.html">Connectomics</a></li>
<li><a href="nircm.html" class="current">NIRCM</a></li>
<li><a href="phealth.html">phealth</a></li>
</ul></li>
<li><a class="dropdown-toggle" href="#">Hacks</a>
<ul class="dropdown-menu" data-role="dropdown">
<li><a href="nudtpaper.html">nudtpaper</a></li>
<li><a href="udpip.html">udp/ip</a></li>
<li><a href="nrf51822.html">nrf51822</a></li>
<li><a href="kicad.html">kicad</a></li>
<li><a href="mathjax.html">mathjax</a></li>
</ul></li>
</ul></nav></div></div>
</header>
<div class="page"><div class="page-content margin20"><div class="page-container">
<h1>NIR videos and spatio-temporal processing</h1>
<h2>Nexys &ndash; boards and vhdl basics</h2>

<p class=readable-text><strong>Nexys3:</strong></p>
<div class="example margin0"><pre>
Device : xc6slx16-csg324-3
SPI bus-width should be <code>4</code> ?
</pre></div>

<p class=readable-text><strong>Nexys4:</strong></p>
<div class="example margin0"><pre>
Device : xc7a100t-csg324-1
</pre></div>

<p class=readable-text><strong>How to program?</strong></p>
<div class="example margin0"><pre>
$ djtgcfg prog -f top.bit -d Nexys3 -i 0
</pre></div>
<h1>Connect mt9v034 with dual&ndash;pmods</h1>
<h2>NIR &ndash; the hardware</h2>

<p class=readable-text><strong>mt9v034 :</strong> <br />
Look from top-down, on the camera side.</p>
<table class="table hovered bordered">
<tr class="r1"><td class="c1"><strong>12</strong> </td><td class="c2"> <strong>11</strong> </td><td class="c3"> <strong>10</strong> </td><td class="c4"> <strong>9</strong> </td><td class="c5"> <strong>8</strong> </td><td class="c6"> <strong>7</strong> </td><td class="c7"> <strong>6</strong> </td><td class="c8"> <strong>5</strong> </td><td class="c9"> <strong>4</strong> </td><td class="c10"> <strong>3</strong> </td><td class="c11"> <strong>2</strong> </td><td class="c12"> <strong>1</strong> </td></tr>
<tr class="r2"><td class="c1">D1 </td><td class="c2"> PCK </td><td class="c3"> D3 </td><td class="c4"> LED </td><td class="c5"> SDA </td><td class="c6"> FRV </td><td class="c7"> D9 </td><td class="c8"> C_P </td><td class="c9"> D_P </td><td class="c10"> D8 </td><td class="c11"> D6 </td><td class="c12"> <strong>VCC</strong> </td></tr>
<tr class="r3"><td class="c1">D2 </td><td class="c2"> D0 </td><td class="c3"> XCK </td><td class="c4"> D4 </td><td class="c5"> SCK </td><td class="c6"> EXP </td><td class="c7"> LIV </td><td class="c8"> C_N </td><td class="c9"> D_N </td><td class="c10"> D7 </td><td class="c11"> D5 </td><td class="c12"> <strong>GND</strong> </td></tr>
<tr class="r4"><td class="c1"><strong>13</strong> </td><td class="c2"> <strong>14</strong> </td><td class="c3"> <strong>15</strong> </td><td class="c4"> <strong>16</strong> </td><td class="c5"> <strong>17</strong> </td><td class="c6"> <strong>18</strong> </td><td class="c7"> <strong>19</strong> </td><td class="c8"> <strong>20</strong> </td><td class="c9"> <strong>21</strong> </td><td class="c10"> <strong>22</strong> </td><td class="c11"> <strong>23</strong> </td><td class="c12"> <strong>24</strong>
</td></tr></table>

<p class=readable-text>where <code>D0</code>, <code>D1</code> and <code>C_P</code>, <code>C_N</code>, <code>D_P</code>, <code>D_N</code> are NC.</p>

<p class=readable-text><strong>Pmod C :</strong> (GND and VCC are more closer to the boards)</p>
<table class="table hovered bordered">
<tr class="r1"><td class="c1"><strong>7</strong> </td><td class="c2"> <strong>8</strong> </td><td class="c3"> <strong>9</strong> </td><td class="c4"> <strong>10</strong> </td><td class="c5"> <strong>11</strong> </td><td class="c6"> <strong>12</strong> </td></tr>
<tr class="r2"><td class="c1">FRV </td><td class="c2"> D9 </td><td class="c3"> D8 </td><td class="c4"> D6 </td><td class="c5"> <strong>GND</strong> </td><td class="c6"> <strong>VCC</strong> </td></tr>
<tr class="r3"><td class="c1">EXP </td><td class="c2"> LIV </td><td class="c3"> D7 </td><td class="c4"> D5 </td><td class="c5"> - </td><td class="c6"> - </td></tr>
<tr class="r4"><td class="c1"><strong>1</strong> </td><td class="c2"> <strong>2</strong> </td><td class="c3"> <strong>3</strong> </td><td class="c4"> <strong>4</strong> </td><td class="c5"> <strong>5</strong> </td><td class="c6"> <strong>6</strong>
</td></tr></table>

<p class=readable-text><strong>Pmod B :</strong> (GND and VCC are more closer to the boards)</p>
<table class="table hovered bordered">
<tr class="r1"><td class="c1"><strong>7</strong> </td><td class="c2"> <strong>8</strong> </td><td class="c3"> <strong>9</strong> </td><td class="c4"> <strong>10</strong> </td><td class="c5"> <strong>11</strong> </td><td class="c6"> <strong>12</strong> </td></tr>
<tr class="r2"><td class="c1">LED </td><td class="c2"> D3 </td><td class="c3"> <strong>XCK</strong> </td><td class="c4"> <strong>PCK</strong> </td><td class="c5"> <strong>GND</strong> </td><td class="c6"> <strong>VCC</strong> </td></tr>
<tr class="r3"><td class="c1">D2 </td><td class="c2"> SDA </td><td class="c3"> D4 </td><td class="c4"> SCK </td><td class="c5"> - </td><td class="c6"> - </td></tr>
<tr class="r4"><td class="c1"><strong>1</strong> </td><td class="c2"> <strong>2</strong> </td><td class="c3"> <strong>3</strong> </td><td class="c4"> <strong>4</strong> </td><td class="c5"> <strong>5</strong> </td><td class="c6"> <strong>6</strong>
</td></tr></table>

<p class=readable-text><strong>Note:</strong> we should place <strong>clk</strong> pins on GCLK sites, where <code>C-1 (H3)</code>, <code>B-9 (K3)</code>, <code>B-10 (K5)</code>. We wrap B9 and B10 to <strong>XCK</strong> and <strong>PCK</strong>. And we add insulate via Tin foil (锡铂纸).</p>

<p class=readable-text>We wire (where FPGA is the master)</p>
<table class="table hovered bordered">
<tr class="r1"><td class="c1"><strong>Port</strong> </td><td class="c2"> <strong>mt9v034-devboard</strong> </td><td class="c3"> <strong>IO (FPGA is the master)</strong> </td><td class="c4"> <strong>Annotation</strong> </td></tr>
<tr class="r2"><td class="c1">DCMI_SYS_CLK </td><td class="c2"> XCK </td><td class="c3"> Output </td><td class="c4"> <strong>system clock</strong> </td></tr>
<tr class="r3"><td class="c1">DCMI_CLK </td><td class="c2"> PCK </td><td class="c3"> Input </td><td class="c4"> <strong>Data clock</strong> </td></tr>
<tr class="r4"><td class="c1">DCMI_EXP </td><td class="c2"> EXP </td><td class="c3"> Output </td><td class="c4"> <strong>Exposure</strong> </td></tr>
<tr class="r5"><td class="c1">DCMI_DATA&lt;7:0&gt; </td><td class="c2"> D9 &ndash; D2 </td><td class="c3"> Input </td><td class="c4"> <strong>Data</strong> </td></tr>
<tr class="r6"><td class="c1">DCMI_HSYNC </td><td class="c2"> LIV </td><td class="c3"> Input </td><td class="c4"> <strong>Line valid</strong> </td></tr>
<tr class="r7"><td class="c1">DCMI_VSYNC </td><td class="c2"> FRV </td><td class="c3"> Input </td><td class="c4"> <strong>Frame valid</strong> </td></tr>
<tr class="r8"><td class="c1">DCMI_LED </td><td class="c2"> LED </td><td class="c3"> Input </td><td class="c4"> </td></tr>
<tr class="r9"><td class="c1">DCMI_SCK </td><td class="c2"> SCK </td><td class="c3"> Inout <strong>(pullup)</strong> </td><td class="c4"> </td></tr>
<tr class="r10"><td class="c1">DCMI_SDA </td><td class="c2"> SDA </td><td class="c3"> Inout <strong>(pullup)</strong> </td><td class="c4">
</td></tr></table>

<p class=readable-text><code>Updated:</code> I build my own mt9v034 to pmods connector using eagle ! See:</p>
<div class="panel margin10 padding0"><div class="panel-content fg-dark">
<img src="pics/mt9v034conn.sch.png" alt="schematic" width="400px" class="place-left margin10"/><div class="page"><div class="page-content margin10 nlm nrm">
<p class="text-muted">The schmeatic of MT9v034 to two pmods. Most <em>simple</em>, most <em>naive</em>, most <em>startup</em> boards. I used mostly <em>labels</em> in drawing this boards. And I do 1.5k Ohm pull-up on SDA and SCL line.</p>
</div></div></div></div>
<div class="panel margin10 padding0"><div class="panel-content fg-dark">
<img src="pics/mt9v034conn.brd.png" alt="schematic" width="400px" class="place-left margin10"/><div class="page"><div class="page-content margin10 nlm nrm">
<p class="text-muted">The PCB layout of MT9v034 connector. Hey, it's totally a mess, isn't it ? I do autorouter all the way as a beginner. May be I should do manual route :)</p>
</div></div></div></div>
<div class="example margin0"><pre>
By comparing PX4Flow and the mt9v034 taobao board, we found some common connections, <code>OE</code> (active HIGH) tied to VCC, <code>RSVD</code> tied to GND. <code>BYPASS_CLKIN_P</code> and <code>SER_DATAIN_P</code> are tied to GND, while <code>BYPASS_CLKIN_N</code> and <code>SER_DATAIN_N</code> are tied to VCC with 1k Ohm pull-up resistor.
However, for mt9v034-dev, the <code>STANDBY</code> is tied to GND, and the <code>RESET_N</code> is tied to VCC with 10k Ohm pull-up resistor. For PX4Flow, these two pins are controlled by MCU. For mt9v034-dev, <code>SCTRL_ADDR0</code> and <code>SCTRL_ADDR1</code> are tied to GND, while for PX4Flow, these pins are tied to VCC.
These two boards works in master mode, with steroscopy mode disabled. <code>SCK</code> and <code>SDA</code> should be pulled-up with 1.5K Ohm resistors when no other I2C peripheral is connected.
</pre></div>
<h2>NIR &ndash; boot mt9v034 via nexys3</h2>

<p class=readable-text>In principles, the mt9v034 works <code>output wide-VGA image at 60fps</code> by default.</p>
<div class="example margin0"><pre>
By injecting <code>DCMI_SYS_CLK</code> with 25MHz clock input, and trigger <code>DCMI_EXP</code> with a rising-edge sensitive pulse (<strong>1000</strong> cycles duty period, in snapshot or slave mode; in master mode, <code>DCMI_EXP</code> may tie to GND). We may monitor the <code>DCMI_DATA</code> bus, <code>DCMI_HSYNC</code> and <code>DCMI_VSYNC</code> signals, as well as <code>DCMI_LED</code> pins.
<code>DCMI_VSYNC</code> is HIGH valid during the whole imaging process (a frame), <code>DCMI_HSYNC</code> is periodorically HIGH valid. The image format is <strong>752x480</strong>. However, currently <code>DCMI_CLK</code> could not register exactly <code>752</code> datum each <strong>HSYNC</strong> pules. <em>(need debug this)</em>. Strange, <code>DCMI_CLK</code> may be <strong>26.6</strong>MHz PLL locked even if we inject a <strong>25</strong>MHz <code>DCMI_SYS_CLK</code>.
</pre></div>
<h2>NIR &ndash; the wrapper of i2c_io_16bit.vhd</h2>

<p class=readable-text>With <code>ADDR0</code> and <code>ADDR1</code> pins pulled low on mt9v034-dev, the address is <code>0x48</code>, with the last bit denotes write (&rsquo;0&rsquo;) or read (&rsquo;1&rsquo;). Therefore, the mt9v034 board has <code>0x90</code> for <strong>write</strong>, <code>0x91</code> for <strong>read</strong>. We build dedicated module <code>i2c_io_16bit.vhd</code> to handle the <strong>Read/Write</strong> process to mt9v034.</p>
<table class="table hovered bordered">
<tr class="r1"><td class="c1">0x90 (0x91) </td><td class="c2"> REG_ADDRESS </td><td class="c3"> WB1 (RB0) </td><td class="c4"> WB2 (RB0)
</td></tr></table>

<p class=readable-text>for example, <code>0x90070188</code> <strong>write</strong> 0x0188 to 0x07 in mt9v034, <code>0x9107XXXX</code> <strong>read</strong> DBYTE from 0x07 in mt9v034.</p>
<div class="example margin0"><pre>
As a simple rule-of-the-thumb, we may put <code>0x91000000</code> on data bus, trigger <code>data_stream_in_stb</code>, and read out the content of <code>0x00</code> on mt9v034 by acknowledge <code>data_stream_out_stb</code>, and finally put the register (which is the CHIPID, <code>0x1324</code>) on BCD segment display.
</pre></div>

<p class=readable-text>Another simple example is command <code>0x900400FF</code>, which changes the <code>WINDOW_WIDTH</code> to <strong>256</strong>, this can also be verified via Chipscope.</p>
<h2>NIR &ndash; config mt9v034 (copied from px4flow)</h2>

<p class=readable-text>After testing the <strong>R/W</strong> functionality of <code>i2c_io_16bit.vhd</code>, we next store all the command and registers in the <code>mt9v034.coe</code>, and loaded in a rom to config this camera module. The top module, which is called <code>mt9v034.vhd</code>, embedded the <strong>mt9v034.coe</strong>, sequentially read the content out, and config the device via I2C protocol.</p>

<p class=readable-text>We port the source code <strong>mt9v034.c</strong> in PX4Flow to NIR project, (<strong>Context A</strong>, context, is like a fast stack-switch machanism, context B in PX4Flow is used for videos streaming only, while context A is for practical optical flow calculation).</p>

<p class=readable-text><strong>Context A/B</strong></p>
<table class="table hovered bordered">
<tr class="r1"><td class="c1"><strong>Register</strong> </td><td class="c2"> <strong>Name</strong> </td><td class="c3"> <strong>Default</strong> </td><td class="c4"> <strong>Context A (Context B)</strong> </td><td class="c5"> <strong>COMMAND</strong> </td><td class="c6"> <strong>Annotation</strong> </td></tr>
<tr class="r2"><td class="c1">0x07 </td><td class="c2"> Chip Control </td><td class="c3"> 0x0388 </td><td class="c4"> 0x0188 (0x8188) </td><td class="c5"> 90070188 </td><td class="c6"> <strong>0x0088</strong> </td></tr>
<tr class="r3"><td class="c1">0x03 (OxCB) </td><td class="c2"> WINDOW_HEIGHT </td><td class="c3"> 480 </td><td class="c4"> 64*4 (120*4) </td><td class="c5"> 90030100 </td><td class="c6"> 4-binning </td></tr>
<tr class="r4"><td class="c1">0x04 (0xCC) </td><td class="c2"> WINDOW_WIDTH </td><td class="c3"> 752 </td><td class="c4"> 64*4 (188*4) </td><td class="c5"> 90040100 </td><td class="c6"> </td></tr>
<tr class="r5"><td class="c1">0x05 </td><td class="c2"> Hor Blanking </td><td class="c3"> 4 + 91 </td><td class="c4"> (752 - 64*4) + 91 </td><td class="c5"> 9005024B </td><td class="c6"> </td></tr>
<tr class="r6"><td class="c1">0x06 </td><td class="c2"> Ver Blanking </td><td class="c3"> 45 </td><td class="c4"> 10 </td><td class="c5"> 9006000A </td><td class="c6"> </td></tr>
<tr class="r7"><td class="c1">0x0D (0x0E) </td><td class="c2"> Read Mode </td><td class="c3"> 0x300 </td><td class="c4"> 0x30A (0x305) </td><td class="c5"> 900D030A </td><td class="c6"> row bin-4, col bin-4 </td></tr>
<tr class="r8"><td class="c1">0x01 </td><td class="c2"> Column Start </td><td class="c3"> 1 </td><td class="c4"> (752 - 64*4)/2 + 1 </td><td class="c5"> 900100F9 </td><td class="c6"> Center Window </td></tr>
<tr class="r9"><td class="c1">0x02 </td><td class="c2"> Row Start </td><td class="c3"> 4 </td><td class="c4"> (480 - 64*4)/2 + 4 </td><td class="c5"> 90020074 </td><td class="c6"> </td></tr>
<tr class="r10"><td class="c1">0x08 </td><td class="c2"> Coarse Shutter Width 1 </td><td class="c3"> </td><td class="c4"> </td><td class="c5"> 900801BB </td><td class="c6"> </td></tr>
<tr class="r11"><td class="c1">0x09 </td><td class="c2"> Coarse Shutter Width 2 </td><td class="c3"> </td><td class="c4"> </td><td class="c5"> 900901D9 </td><td class="c6"> </td></tr>
<tr class="r12"><td class="c1">0x0A </td><td class="c2"> Coarse Width Control   </td><td class="c3"> </td><td class="c4"> </td><td class="c5"> 900A0164 </td><td class="c6"> </td></tr>
<tr class="r13"><td class="c1">0x0B </td><td class="c2"> Coarse Width Total     </td><td class="c3"> </td><td class="c4"> </td><td class="c5"> 900B01E0 </td><td class="c6">
</td></tr></table>

<p class=readable-text><strong>General Settings</strong></p>
<table class="table hovered bordered">
<tr class="r1"><td class="c1"><strong>Register</strong> </td><td class="c2"> <strong>Name</strong> </td><td class="c3"> <strong>Default</strong> </td><td class="c4"> <strong>Context A (Context B)</strong> </td><td class="c5"> <strong>COMMAND</strong> </td><td class="c6"> <strong>Annotation</strong> </td></tr>
<tr class="r2"><td class="c1">0x70 </td><td class="c2"> Row Noise Corr </td><td class="c3"> 0 </td><td class="c4"> 0x0000 </td><td class="c5"> 90700000 </td><td class="c6"> </td></tr>
<tr class="r3"><td class="c1">0xAF </td><td class="c2"> AEC/AGC Enable </td><td class="c3"> 0x3 </td><td class="c4"> 0x0303 </td><td class="c5"> 90AF0303 </td><td class="c6"> </td></tr>
<tr class="r4"><td class="c1">0x0F </td><td class="c2"> HDR </td><td class="c3"> 0x0100 </td><td class="c4"> 0x0000 </td><td class="c5"> 900F0000 </td><td class="c6"> </td></tr>
<tr class="r5"><td class="c1">0xAC </td><td class="c2"> Min exposure </td><td class="c3"> 1 </td><td class="c4"> 1 </td><td class="c5"> 90AC0001 </td><td class="c6"> </td></tr>
<tr class="r6"><td class="c1">0xAD </td><td class="c2"> Max exposure </td><td class="c3"> 0x01E0 </td><td class="c4"> 0x80 </td><td class="c5"> 90AD0050 </td><td class="c6"> </td></tr>
<tr class="r7"><td class="c1">0xAB </td><td class="c2"> Max gain </td><td class="c3"> 0x40 (64) </td><td class="c4"> 0x40 (64) </td><td class="c5"> 90AB0040 </td><td class="c6"> </td></tr>
<tr class="r8"><td class="c1">0xB0 </td><td class="c2"> AEC/AGC Pixel Count </td><td class="c3"> 0xABE0 </td><td class="c4"> 0x1000 (4096) </td><td class="c5"> 90B01000 </td><td class="c6"> </td></tr>
<tr class="r9"><td class="c1">0xA5 </td><td class="c2"> AEC/AGC Desired Bin </td><td class="c3"> 0x3A </td><td class="c4"> 0x32 (50) </td><td class="c5"> 90A50032 </td><td class="c6"> </td></tr>
<tr class="r10"><td class="c1">0x1C </td><td class="c2"> ADC Res Control </td><td class="c3"> 0x0302 </td><td class="c4"> 0x0202 </td><td class="c5"> 901C0202 </td><td class="c6"> </td></tr>
<tr class="r11"><td class="c1">0x7F </td><td class="c2"> Test pattern </td><td class="c3"> 0x0000 </td><td class="c4"> 0x0000 </td><td class="c5"> 907F0000 </td><td class="c6"> </td></tr>
<tr class="r12"><td class="c1">0xA6 </td><td class="c2"> AEC update Freq </td><td class="c3"> 0x2 </td><td class="c4"> 0x2 </td><td class="c5"> 90A60002 </td><td class="c6"> </td></tr>
<tr class="r13"><td class="c1">0xA8 </td><td class="c2"> AEC lowpass Filter </td><td class="c3"> 0x0 </td><td class="c4"> 0x1 </td><td class="c5"> 90A80001 </td><td class="c6"> </td></tr>
<tr class="r14"><td class="c1">0xA9 </td><td class="c2"> AGC update Freq </td><td class="c3"> 0x2 </td><td class="c4"> 0x2 </td><td class="c5"> 90A90002 </td><td class="c6"> </td></tr>
<tr class="r15"><td class="c1">0xAA </td><td class="c2"> AGC lowpass Filter </td><td class="c3"> 0x2 </td><td class="c4"> 0x2 </td><td class="c5"> 90AA0002 </td><td class="c6">
</td></tr></table>

<p class=readable-text><strong>finally, reset</strong></p>
<table class="table hovered bordered">
<tr class="r1"><td class="c1"><strong>Register</strong> </td><td class="c2"> <strong>Name</strong> </td><td class="c3"> <strong>Default</strong> </td><td class="c4"> <strong>Context A (Context B)</strong> </td><td class="c5"> <strong>COMMAND</strong> </td><td class="c6"> <strong>Annotation</strong> </td></tr>
<tr class="r2"><td class="c1">0x0C </td><td class="c2"> Reset </td><td class="c3"> </td><td class="c4"> </td><td class="c5"> 0x900C0001 </td><td class="c6"> </td></tr>
<tr class="r3"><td class="c1">0x00 </td><td class="c2"> Chip ID </td><td class="c3"> </td><td class="c4"> </td><td class="c5"> 0x91000000 </td><td class="c6"> <strong>read back</strong>
</td></tr></table>

<p class=readable-text>The rom is a simplified form of PX4flow, where we may add more functionality with different configurations of switches.</p>
<h1>Insights</h1>

<p class=readable-text>Non-invasive gluco tracking using Near-Infra-Red videos ? see, <a href="http://www.eeboard.com/bbs/thread-35333-1-1.html" target=&ldquo;blank&rdquo;>eeboard</a> and <a href="http://www.integrity-app.com/the-glucotrack/the-products/" target=&ldquo;blank&rdquo;>glucotrack</a> .</p>
<div class="panel ribbed-amber"><div class="panel-content">
Page generated 2015-01-08 11:19:31 UTC, by <strong>liubenyuan</strong> via a <strong>metro</strong> style <a href="https://github.com/wsshin/jemdoc_mathjax" target="blank">jemdoc+MathJax</a>.
</div></div>
</div></div></div>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
